#!/bin/bash
# Script exécuté au login pour créer les liens symboliques

USER_HOME="/home/$USER"
PERSONNEL="$USER_HOME/Personnel"

# Attendre que Personnel soit monté (max 30 secondes)
for i in {1..30}; do
    if mountpoint -q "$PERSONNEL" 2>/dev/null; then
        break
    fi
    sleep 1
done

# Si Personnel n'est pas monté, quitter
if ! mountpoint -q "$PERSONNEL" 2>/dev/null; then
    exit 0
fi

# Créer les liens symboliques vers Personnel
for dir in Documents Images Téléchargements Vidéos Musique Bureau Modèles; do
    # Si le dossier existe dans ~/ et est vide, le supprimer
    if [ -d "$USER_HOME/$dir" ] && [ ! -L "$USER_HOME/$dir" ]; then
        if [ -z "$(ls -A $USER_HOME/$dir 2>/dev/null)" ]; then
            rmdir "$USER_HOME/$dir" 2>/dev/null
        fi
    fi
    
    # Créer le lien symbolique si il n'existe pas
    if [ ! -e "$USER_HOME/$dir" ] && [ -d "$PERSONNEL/$dir" ]; then
        ln -s "$PERSONNEL/$dir" "$USER_HOME/$dir"
    fi
done

exit 0
